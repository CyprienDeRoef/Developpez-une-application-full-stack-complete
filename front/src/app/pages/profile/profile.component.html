<app-header></app-header>

<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      
      <!-- Profile Form Section -->
      <section class="text-center mb-5" aria-label="Formulaire de profil">
        <h2 class="mb-4">Profil utilisateur</h2>

        <!-- Success Message -->
        <app-alert-message 
          type="success" 
          [message]="successMessage" 
          (dismissed)="successMessage = null">
        </app-alert-message>

        <!-- Error Message -->
        <app-alert-message 
          type="danger" 
          [message]="error" 
          (dismissed)="error = null">
        </app-alert-message>

        <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
          <!-- Name Field -->
          <app-form-field
            [formGroup]="profileForm"
            controlName="name"
            label=""
            type="text"
            placeholder="Username"
            id="name"
            [errorMessages]="{'minlength': 'Le nom doit contenir au moins 3 caractères'}">
          </app-form-field>

          <!-- Email Field -->
          <app-form-field
            [formGroup]="profileForm"
            controlName="email"
            label=""
            type="email"
            placeholder="email@email.fr"
            id="email">
          </app-form-field>

          <!-- Password Field -->
          <app-form-field
            [formGroup]="profileForm"
            controlName="password"
            label=""
            type="password"
            placeholder="Mot de passe"
            id="password"
            [errorMessages]="{'minlength': 'Le mot de passe doit contenir au moins 8 caractères'}">
          </app-form-field>

          <!-- Submit Button -->
          <button
            type="submit"
            class="btn btn-primary btn-lg px-5 rounded-3"
            [disabled]="profileForm.invalid || loading"
            style="background-color: #7c5cbf; border-color: #7c5cbf;"
          >
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            Sauvegarder
          </button>
        </form>
      </section>

      <hr class="my-5">

      <!-- Subscriptions Section -->
      <section aria-label="Mes abonnements">
        <h3 class="mb-4 text-center">Abonnements</h3>

        <div *ngIf="subscriptions.length === 0" class="text-center text-muted py-4">
          Vous n'êtes abonné à aucun thème
        </div>

        <div class="row g-3">
          <div class="col-12 col-md-6" *ngFor="let topic of subscriptions">
            <app-topic-card 
              [topic]="topic" 
              [mode]="'unsubscribe'"
              (actionClicked)="unsubscribe($event.id)">
            </app-topic-card>
          </div>
        </div>
      </section>

    </div>
  </div>
</main>
